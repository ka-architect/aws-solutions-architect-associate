# Elastic Load Balancer (ELB)

## Scalability
- **Scalability:** how your application adapts to increase in traffic volumes
- 2 Types: Vertical Scaling and Horizontal Scaling
- **Vertical Scaling:** increase the size of instance (CPU/Memory) when limited by hardware
    - common for non-distributed systems, DB's and cache
- **Horizontal Scaling:** increasing the number of instances for app
    - common for distributed systems, web apps and modern apps

## High Availability
- Ability for your application to withstand a localized outage
- Goes hand-in-hand with horizontal scaling, since it can run in multiple availability zones
- Can be passive: pointing to a stand by RDS when primary AZ goes down

## EC2 and Scalability and HA
- Vertical Scaling: increase the instance type of EC2 from small to large
- Horizontal Scaling: increase number of EC2 instances
- High Availability: run EC2 in multiple AZ (with load balancing and auto-scaling)

## Elastic Load Balancer (ELB)
- **Load Balancer:** servers that forward requests to a set of instances downstream by providing single point of DNS access to your application
- **Elastic Load Balancer (ELB):** managed AWS service for load balancing
- Provides health check capability: if health check fails, stops routing to that instance (health check can be direct server or ASG)
- Can be set up as public or private
- Enable downstream instances to accept traffic from LB security group
- Types of ELB: Application LB (ALB), Network LB (NLB), Gateway LB (GLB)

## Application Load Balancer (ALB)
- **ALB:** load balancing for layer 7 (HTTP(S)/websocket) based applications
- Provides a fixed hostname to access
- Used for microservices and container-based applications
- Application servers don't see the IP of client: so add headers for Client IP, Port, protocol information

## Network Load Balancer (NLB)
- **NLB:** load balancing for layer 4 (TCP/UDP) based applications
- Supports millions of requests per second at low latency
- 1 static IP per AZ (supports elastic ip)
- Use case: when app needs to access with set of static IPs (1-3) 
- Can point to instances or ALB

## Gateway Load Balancer (GLB)
- **GLB:** load balancing for layer 3 (IP Packet) based applications
- Use cases
    - deploy, scale, and manage 3rd party network applications in AWS
    - Firewalls, intrustion detection/prevention, packet inspection
- Combines following functions:
    - Transport Network Gateway (single entry/exit point for all traffic)
    - LB (distribute traffic to virtual appliances)
- Uses GENEVE protocol on port 6081

## ELB Stickyness (Session Affinity)
- Ensure same client always communicates with same server within the LB
- Can cause imbalance on the underlying resources
- Works with ALB and NLB and managed by cookie, enabled at target group
- **Application Based Cookies:** custom cookie generated by target, attributes determined by app
- **Duration Based Cookies:** cookie generated by browser, expiry based on duration

## Cross-Zone LB
- Ensures LB distributes evenly to instances in all AZ
- If disabled, LB will just distribute across ELB
- ALB: cross-zone is enabled by default, can be enabled/inherted/disabled at TG, no charges for enabling
- NLB and GLB: not enabled by default, pay for enabling, enabled in attributes of LB

## In-Flight Encryption
- SSL certificates allow encrypted traffic between clients and LB and decrypted by senders/receivers
- Public SSLs are distributed by the Certificate Authority (CA), have an expiration, and must be renewed
- SSL certificates are attached to the LB, LB terminates the SSL connection from client, and uses HTTP to EC2 (VPC traffic is secure)
- LB uses X.509 certificate, managed by AWS Certificate Manager (ACM)
- Must set HTTPS listener, specify certificates, clients can use Server Name Indication (SNI) to specify hostname they reach
- **Server Name Indication (SNI):** solves the problem of loading multiple SSL certs on to a web server
    - client indicates the hostname of target server during initial handshake, server then finds correct certificate or return default
    - only works with ALB, NLB, and CloudFront

## Deregistration Delay (ALB/NLB)
- **Deregistration Delay:** LB feature to complete in-flight requests while deregistering unhealthy underlying servers
- ELB stops sending new requests during this period and waits for existing connections to complete
- New connections will go to other instances in the ELB
- Default value is 300 sec, can set higher, which means higher time to deregister
- Use low value for short requests, use high value for longer requests like uploads

# Auto Scaling Group

## Introduction
- Automatic scaling functionality to handle changes in web traffic that require more or less servers to complete processing
- **Scale Out:** increase the number of servers within the group to match increased load
    - can create new instances and register to ELB during scale out
- **Scale In:** decrease the number of servers with the group to match decreased load
    - will terminate and remove instances from ELB during scale in
- free service, just pay for the amount of underlying servers
- ensure that the minimum, desired, and max count are set to handle scaling
- Has health check feature to manage instances instances that ELB can use as well

## Attributes
- **Launch Template:** information on how to launch EC2 within your ASG (AMI, Type, Storage, Security, network, etc.)
    - Allows to edit and update, maintains versions
    - Can use T2 unlimited burst feature.
    - Allow provisioning using both On-demand and Spot Instances.
    - Creation of parameter subsets.(Partial configuration for reuse and inheritance)
    - Can also be used to launch a standalone instance using AWS Console, SDK and CLI.
- **Launch Configuration (Legacy):** must be recreated every time because modification is not allowed.
- Launch Template recommended By AWS
- Minimum Size, Desired (Scale In), Max (Scale Out), Initial

## Scaling Policies
- **Dynamic Scaliing Policies:** scaling based on dynamic situations
    - **Target Tracking Scaling:** triggered via simple metric such as CPU
    - **Simple/Step Scaling:** triggered via CloudWatch alerts
- **Scheduled Scaling:** scaling based on predictable patterns
- **Predictive Scaling:** forecast load and schedule scaling ahead of time
- Metrics for scaling: CPU, request count per target, average network in/out, custom metrics within CloudWatch (Queue Depth)

## Scaling Cooldowns
- **Scaling Cooldown:** configurable time period after a scaling action occurs (default 300 sec)
- During cooldown, ASG will not modify underlying servers to provide a baseline of performance for next action
- Tip: Reduce EC2 instance boot times with AMI's